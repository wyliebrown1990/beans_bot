<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Progress</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script>
        async function fetchProgress() {
            const response = await fetch('/progress_data');
            const data = await response.json();
            const progressElement = document.getElementById('progress');
            progressElement.innerHTML = data.map(status => `<p>${status}</p>`).join('');
            if (data.length > 0 && (data[data.length - 1].includes('complete') || data[data.length - 1].includes('successfully'))) {
                if (!document.getElementById('add-more-button')) {
                    const addMoreButton = document.createElement('button');
                    addMoreButton.id = 'add-more-button';
                    addMoreButton.innerText = 'Add More Training Data';
                    addMoreButton.onclick = () => {
                        const params = new URLSearchParams({
                            job_title: "{{ job_title }}",
                            company_name: "{{ company_name }}",
                            industry: "{{ industry }}",
                            username: "{{ username }}"
                        });
                        window.location.href = '/upload_options?' + params.toString();
                    };
                    progressElement.appendChild(addMoreButton);
                }
                if (!document.getElementById('start-interview-button')) {
                    const startInterviewButton = document.createElement('button');
                    startInterviewButton.id = 'start-interview-button';
                    startInterviewButton.innerText = 'Start Interview!';
                    startInterviewButton.onclick = () => {
                        const params = new URLSearchParams({
                            job_title: "{{ job_title }}",
                            company_name: "{{ company_name }}",
                            industry: "{{ industry }}",
                            username: "{{ username }}"
                        });
                        window.location.href = 'http://localhost:5012/?' + params.toString();
                    };
                    progressElement.appendChild(startInterviewButton);
                }
            } else {
                setTimeout(fetchProgress, 1000);
            }
        }
        document.addEventListener('DOMContentLoaded', fetchProgress);
    </script>
</head>
<body>
    <div id="page-container">
        <div id="content-wrap">
            <header>
                <h1>Processing Progress</h1>
            </header>
            <div id="progress"></div>
        </div>
        <footer id="footers">
            <p>&copy; Your Company 2024</p>
        </footer>
    </div>
</body>
</html>
